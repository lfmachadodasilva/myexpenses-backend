sudo: required

services:
    - docker

notifications:
    email:
        on_success: never
        on_failure: change

before_install:
    # install heroku CLI
    - wget -qO- https://toolbelt.heroku.com/install.sh | sh
    # login to docker registries (dockerhub + heroku)
    - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
    - echo "$HEROKU_PASSWORD" | docker login -u "$HEROKU_USERNAME" --password-stdin registry.heroku.com

script:
    - docker build -t lfmachadodasilva/myexpenses-backend:myexpenses-backend-$TRAVIS_BUILD_NUMBER .
    - docker tag lfmachadodasilva/myexpenses-backend:myexpenses-backend-$TRAVIS_BUILD_NUMBER registry.heroku.com/$HEROKU_APP_NAME/api-csharp

deploy:
    provider: script
    script:
        docker push lfmachadodasilva/myexpenses-backend:myexpenses-backend-$TRAVIS_BUILD_NUMBER;
        docker push registry.heroku.com/$HEROKU_APP_NAME/api-csharp;
        heroku container:release api-csharp --app $HEROKU_APP_NAME
    branch: master
